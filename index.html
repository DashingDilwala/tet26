<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Online Video Player</title>
    <meta name="description" content="Watch videos online with our interactive video player." />
    <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>

    <style>
        body {
            margin: 0;
            background-color: #181818;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #heading-container {
            background-color: #282828;
            text-align: center;
            font-size: 22px;
            padding: 5px 40px;
            margin: 20px auto;
            border: 2px solid #00BFFF;
            border-radius: 50px;
            width: fit-content;
        }

        #video-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 20px;
        }

        #video {
            width: 80%;
            max-width: 1000px;
            padding: 20px 40px;
            margin: 0 auto;
        }

        /* Disclaimer Section */
        .disclaimer {
            background-color: #282828;
            color: #fff;
            padding: 10px;
            margin: 20px auto;
            text-align: center;
            font-size: 14px;
            border: 1px solid #00BFFF;
            border-radius: 5px;
            width: 90%;
            max-width: 1000px;
        }

        .disclaimer marquee {
            color: #FF3333;
        }

        /* Telegram Button Section */
        .telegram-button {
            text-align: center;
            margin: 20px 0;
        }

        .telegram-button a {
            background-color: #00BFFF;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
        }

        .telegram-button a:hover {
            background-color: #009ACD;
        }

        /* Second Popup */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #282828;
            color: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0px 0px 20px #00BFFF;
            width: 300px; /* Further increased popup size */
        }

        .popup-content h2 {
            margin-bottom: 20px;
            font-size: 20px; /* Larger heading */
        }

        .popup-content p {
            margin-bottom: 25px;
            font-size: 20px; /* Larger text */
        }

        .popup-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .join-btn-popup,
        .already-btn {
            background: #00BFFF;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px; /* Larger button text */
        }

        .join-btn-popup:hover,
        .already-btn:hover {
            background: #009ACD;
        }

        .telegram-link {
            color: #00BFFF;
            text-decoration: none;
            font-weight: bold;
        }

        .telegram-link:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    

    <!-- Disclaimer Section (Moved above the video player) -->
    <div class="disclaimer">
        <marquee behavior="scroll" direction="left">
            "Copyright Disclaimer: We do not stream any of the channels included in this website. All streaming links are from third-party websites freely available on the internet. All content is the copyright of its respective owners."
        </marquee>
    </div>

    <div id="content"></div>

    <!-- Telegram Button Section (Moved below the video player) -->
    <div class="telegram-button">
        <a href="https://t.me/+xl-C7GFGTkM4MDk5" target="_blank">Join Telegram Channel</a>
    </div>

    <!-- Second Popup -->
    <div class="popup" id="customPopup">
        <div class="popup-content">
            <h2>Support Us!</h2>
            <p>Join our Telegram channel <a href="https://t.me/cricketguru071" class="telegram-link">Cricket Guru</a> for more updates.</p>
            <div class="popup-buttons">
                <button class="join-btn-popup" onclick="window.location.href='https://t.me/cricketguru071'">Join Now</button>
                <button class="already-btn" onclick="closePopup()">Already Joined</button>
            </div>
        </div>
    </div>

    <script>
        // Play video with given ID
        function playVideo(videoId) {
            console.log("Attempting to fetch video with ID:", videoId);

            // Fix: Use the correct URL format - ensure no trailing slash
            fetch(`/api/videos/${videoId}`)
                .then(res => {
                    console.log("Response status:", res.status);
                    return res.text().then(text => {
                        // Debug: Log the raw response to see what's coming back
                        console.log("Raw response:", text);

                        try {
                            // Try to parse as JSON
                            return JSON.parse(text);
                        } catch (e) {
                            // If parsing fails, throw with details
                            throw new Error(`Failed to parse response: ${e.message}. Raw response: ${text.substring(0, 100)}...`);
                        }
                    });
                })
                .then(data => {
                    console.log("Video data received:", data);

                    if (!data || !data.url) {
                        throw new Error(`Video data invalid for ID "${videoId}"`);
                    }

                    const videoHTML = `
                      <div id="video-container">
                        <div id="video"></div>
                      </div>
                    `;
                    document.getElementById('content').innerHTML = videoHTML;

                    const videoUrl = data.requires_cors ?
                        `/api/proxy?url=${encodeURIComponent(data.url)}` :
                        data.url;

                    console.log("Using video URL:", videoUrl);

                    jwplayer("video").setup({
                        file: videoUrl,
                        type: 'application/x-mpegURL',
                        logo: { file: "jaishreeram.png", hide: true, position: 'top-right' },
                        preload: 'auto',
                        autostart: false,
                        width: "100%"
                    }).on('error', function (e) {
                        console.error('JWPlayer error:', e);
                        document.getElementById('content').innerHTML +=
                            `<div style="color:red;text-align:center;margin-top:20px;">
                            Error playing video: ${e.message}
                        </div>`;
                    });
                })
                .catch(err => {
                    console.error('Error fetching or playing video:', err);
                    document.getElementById('content').innerHTML =
                        `<div style="text-align:center;margin-top:100px;">
                        <h2>Error loading video</h2>
                        <p>Could not load video for ID "${videoId}"</p>
                        <p>Error: ${err.message}</p>
                        <a href="/" style="color:#00BFFF;">Back to home</a>
                    </div>`;
                });
        }

        // Play default video if no video ID is provided
        function playDefaultVideo() {
            const videoHTML = `
                  <div id="video-container">
                    <div id="video"></div>
                  </div>
                `;
            document.getElementById('content').innerHTML = videoHTML;

            jwplayer("video").setup({
                file: "https://v18tataplaysyndication.akamaized.net/bpk-tv/Sports18_1_HD_voot_MOB/output03/index.m3u8?hdnea=exp=1742664424~acl=/*~hmac=44f4e3c1536bdc0d6cc2ed87f9b07b5f13414f66f715fa0b0bd2d3ad854e81a8&by=Bexo",
                type: 'application/x-mpegURL',
                logo: { file: "jaishreeram.png", hide: true, position: 'top-right' },
                preload: 'auto'
            });
        }

        // Close the popup
        function closePopup() {
            document.getElementById('customPopup').style.display = 'none';
        }

        /*** Main Initialization ***/
        document.addEventListener("DOMContentLoaded", function () {
            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);

            // Initialize content based on URL parameters
            if (urlParams.has("id")) {
                playVideo(urlParams.get("id"));
            } else {
                playDefaultVideo();
            }

            // Show the popup after 3 seconds (reduced delay)
            setTimeout(() => {
                document.getElementById('customPopup').style.display = 'block';
            }, 3000); // Changed from 5000ms to 3000ms
        });
    </script>
</body>

</html>
