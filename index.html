<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Player</title>
    <meta name="description" content="Watch videos online with our interactive video player." />
    <script src="https://airplay.bgrid.in/IPTVS/live/voot/1033.m3u8"></script>
    <style>
        body {
            margin: 0;
            background-color: #181818;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #video-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 20px;
        }

        #video {
            width: 80%;
            max-width: 1000px;
            padding: 20px 40px;
            margin: 0 auto;
        }

        .access-denied {
            text-align: center;
            margin-top: 100px;
            color: #FF3333;
            font-size: 28px;
        }
    </style>
</head>
<body>
    <div id="content"></div>

    <script>
        // Play video with given ID
        function playVideo(videoId) {
            console.log("Attempting to fetch video with ID:", videoId);

            fetch(`/api/videos/${videoId}`)
                .then(res => {
                    console.log("Response status:", res.status);
                    return res.text().then(text => {
                        console.log("Raw response:", text);

                        try {
                            return JSON.parse(text);
                        } catch (e) {
                            throw new Error(`Failed to parse response: ${e.message}. Raw response: ${text.substring(0, 100)}...`);
                        }
                    });
                })
                .then(data => {
                    console.log("Video data received:", data);

                    if (!data || !data.url) {
                        throw new Error(`Video data invalid for ID "${videoId}"`);
                    }

                    const videoHTML = `
                      <div id="video-container">
                        <div id="video"></div>
                      </div>
                    `;
                    document.getElementById('content').innerHTML = videoHTML;

                    const videoUrl = data.requires_cors ?
                        `/api/proxy?url=${encodeURIComponent(data.url)}` :
                        data.url;

                    console.log("Using video URL:", videoUrl);

                    jwplayer("video").setup({
                        file: videoUrl,
                        type: 'application/x-mpegURL',
                        logo: { file: "jaishreeram.png", hide: true, position: 'top-right' },
                        preload: 'auto',
                        autostart: false,
                        width: "100%"
                    }).on('error', function (e) {
                        console.error('JWPlayer error:', e);
                        document.getElementById('content').innerHTML +=
                            `<div style="color:red;text-align:center;margin-top:20px;">
                            Error playing video: ${e.message}
                        </div>`;
                    });
                })
                .catch(err => {
                    console.error('Error fetching or playing video:', err);
                    document.getElementById('content').innerHTML =
                        `<div style="text-align:center;margin-top:100px;">
                        <h2>Error loading video</h2>
                        <p>Could not load video for ID "${videoId}"</p>
                        <p>Error: ${err.message}</p>
                        <a href="/" style="color:#00BFFF;">Back to home</a>
                    </div>`;
                });
        }

        // Play default video if no video ID is provided
        function playDefaultVideo() {
            const videoHTML = `
                  <div id="video-container">
                    <div id="video"></div>
                  </div>
                `;
            document.getElementById('content').innerHTML = videoHTML;

            jwplayer("video").setup({
                file: "https://test-streams.mux.dev/tos_ismc/main.m3u8?ref=developerinsider.co",
                type: 'application/x-mpegURL',
                logo: { file: "jaishreeram.png", hide: true, position: 'top-right' },
                preload: 'auto'
            });
        }

        /*** Main Initialization ***/
        document.addEventListener("DOMContentLoaded", function () {
            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);

            // Initialize content based on URL parameters
            if (urlParams.has("id")) {
                playVideo(urlParams.get("id"));
            } else {
                playDefaultVideo();
            }
        });
    </script>
</body>
</html
